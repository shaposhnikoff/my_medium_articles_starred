
# 100 Days of DevOps — Day 28- Introduction to VPC Flow Logs

Welcome to Day 28 of 100 Days of DevOps, Focus for today is VPC Flow logs
> *What are VPC Flow logs?*

* *It comprised of IP traffic information*

* *These logs are useful for troubleshooting network conversations and can be assigned to(Capture Points)*

    ** VPC
    * Subnet
    * Elastic Network Interface*

***NOTE:** Flow logs don’t capture data, so you can’t do packet analysis even if its un-encrypted.*
> ***Setup VPC Flow Logs***

    *Go To AWS Console --> VPC --> Select your VPC --> Flow logs --> Create flow log*

![](https://cdn-images-1.medium.com/max/4988/1*faF1--19O4BN_0KA9RzKUg.png)

![](https://cdn-images-1.medium.com/max/4744/1*8SgiHBYJgwiZ2aXXw8cozw.png)

    ** Filter: Select All(Other options Accept/Reject)*

    ** Destination: Send to CloudWatch Logs*

    ** Destination log group: Go to AWS Console --> CloudWatch --> Logs --> Create log group*

![](https://cdn-images-1.medium.com/max/2892/1*K6drZdBYvvKU59mWOPHvrQ.png)

![](https://cdn-images-1.medium.com/max/2000/1*Y3APUATppEpmnuTV3zl9Fw.png)

* *IAM Role(Click on Set Up Permissions)*

![](https://cdn-images-1.medium.com/max/3232/1*tXyVbHOzYLcRk4bcORJ6cA.png)

![](https://cdn-images-1.medium.com/max/3536/1*y0xqLffk5_lLHTlsl39HHw.png)

* *After filling all the values it will look like this*

![](https://cdn-images-1.medium.com/max/4324/1*bbqhWnDQZeOUBUbjtYDSMA.png)

* *After creating flow logs, if you look for the subnet of this VPC, you will see subnet have flow logs associated with it and this is because it inherited flowlogs from VPC.*

![](https://cdn-images-1.medium.com/max/5012/1*_Q28dWEKXo-82VrFK6gRLQ.png)
> ***Flow Log Record Syntax***

*A flow log record is a space-separated string that has the following format:*

    *<version> <account-id> <interface-id> <srcaddr> <dstaddr> <srcport> <dstport> <protocol> <packets> <bytes> <start> <end> <action> <log-status>*

    *2 123456789010 eni-abc123de 172.31.16.139 172.31.16.21 20641 22 6 20 4249 1418530010 1418530070 ACCEPT OK*

![](https://cdn-images-1.medium.com/max/3508/1*dg55BLfizLIgkMbEcO8qLw.png)

*Reference: [https://docs.aws.amazon.com/vpc/latest/userguide/flow-logs.html](https://docs.aws.amazon.com/vpc/latest/userguide/flow-logs.html)*
> *If you go back to CloudWatch Log group, you will see something like this*

![](https://cdn-images-1.medium.com/max/5740/1*2BJyPnPFQh4CNyFKiSKHsQ.png)

* *As I applied flow logs at the VPC level and as we see that subnet automatically inherited it, if we go at the instance create under this VPC and check the Network Interface, you will see that even your Elastic Network Interface(ENI) inherited these logs*

![](https://cdn-images-1.medium.com/max/5760/1*QFo0eY6TQXbrJza44a9qyg.png)
> ***Flow logs do not capture all IP traffic. The following types of traffic are not logged:***

* *Traffic generated by instances when they contact the Amazon DNS server. If you use your own DNS server, then all traffic to that DNS server is logged.*

* *Traffic generated by a Windows instance for Amazon Windows license activation.*

* *Traffic to and from 169.254.169.254 for instance metadata.*

* *Traffic to and from 169.254.169.123 for the Amazon Time Sync Service.*

* *DHCP traffic.*

* *Traffic to the reserved IP address for the default VPC router.*

* *Traffic between an endpoint network interface and a Network Load Balancer network interface.*
> **Terraform Code**

<iframe src="https://medium.com/media/fa08c59cdb08a39b0172ebcbd4363d87" frameborder=0></iframe>

**GitHub Code Link**
[**100daysofdevops/100daysofdevops**
*Contribute to 100daysofdevops/100daysofdevops development by creating an account on GitHub.*github.com](https://github.com/100daysofdevops/100daysofdevops/tree/master/vpc_flow_logs)

*Looking forward from you guys to join this journey and spend a minimum an hour every day for the next 100 days on DevOps work and post your progress using any of the below medium.*

* *Twitter: [@100daysofdevops](http://twitter.com/100daysofdevops) OR @[lakhera2015](https://twitter.com/lakhera2015)*

* *Facebook: [https://www.facebook.com/groups/795382630808645/](https://www.facebook.com/groups/795382630808645/)*

* *Medium: [https://medium.com/@devopslearning](https://medium.com/@devopslearning)*

* *Slack: [https://devops-myworld.slack.com/messages/CF41EFG49/](https://devops-myworld.slack.com/messages/CF41EFG49/)*

* *GitHub Link:[https://github.com/100daysofdevops](https://github.com/100daysofdevops)*

***Reference***
[**100 Days of DevOps — Day 0**
*D-day is just one day away and finally, this is a continuation of the post(I posted a month earlier)*medium.com](https://medium.com/@devopslearning/100-days-of-devops-day-0-4f2c9750542d)
[**100 Days of DevOps**
*Motivation*medium.com](https://medium.com/@devopslearning/100-days-of-devops-81faf13bf772)
